<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>מערכת הברכות החכמה</title>
    <style>
        /* הגדרת משתנים - ברירת מחדל */
        :root { 
            --primary: #4a90e2; 
            --primary-dark: #357abd; 
            --whatsapp: #25D366; 
            --bg: #e3f2fd;        
            --card: #f0f8ff;      
            --controls-bg: #e1f5fe; 
            --text: #1c1e21; 
            --border-radius: 16px; 
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background-color: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 10px; 
            display: flex; 
            justify-content: center; 
            min-height: 100vh; 
            padding-bottom: 80px; 
            transition: background-color 0.4s ease; 
        }

        .container { 
            width: 100%; 
            max-width: 600px; 
            background: var(--card); 
            padding: 20px; 
            border-radius: var(--border-radius); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            position: relative; 
            min-height: 600px; 
            transition: background-color 0.4s ease;
        }
        
        h1 { text-align: center; font-size: 1.5rem; margin: 10px 0; color: var(--primary-dark); }
        
        /* כפתור חזרה */
        .back-btn { 
            background: #e4e6eb; 
            color: #333; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 12px; 
            font-size: 0.95rem; 
            font-weight: bold; 
            cursor: pointer; 
            width: 100%; 
            display: block; 
            margin-bottom: 5px; 
            transition: 0.2s;
        }
        .back-btn:hover { background: #d0d2d6; }

        .controls-area { 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            background: var(--controls-bg); 
            padding: 15px; 
            border-radius: 12px; 
            transition: background-color 0.4s ease;
        }

        .top-row { 
            display: flex; 
            justify-content: center; 
            align-items: center;     
            width: 100%; 
            gap: 12px;               
            flex-wrap: wrap;         
        }
        
        .sender-toggle { display: flex; background: rgba(255,255,255,0.5); border-radius: 20px; padding: 3px; height: fit-content; }
        .sender-btn { border: none; background: transparent; padding: 6px 12px; border-radius: 16px; cursor: pointer; font-size: 0.9rem; transition: 0.2s; }
        .sender-btn.active { background: white; shadow: 0 2px 4px rgba(0,0,0,0.1); font-weight: bold; color: var(--primary-dark); }

        .emoji-btn { background: white; border: 2px solid #ddd; border-radius: 20px; padding: 6px 12px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 5px; transition: all 0.2s; color: #555; font-size: 0.9rem; height: fit-content; }
        .emoji-btn.active { background: #ffeb3b; border-color: #fbc02d; color: #333; }
        
        .length-wrapper { display: flex; flex-direction: column; align-items: center; }
        .length-label-title { font-size: 0.8rem; font-weight: bold; color: #666; margin-bottom: 3px; }
        .length-selector { display: flex; background: rgba(255,255,255,0.5); border-radius: 20px; padding: 3px; }
        .length-selector label { flex: 1; text-align: center; padding: 6px 12px; border-radius: 16px; cursor: pointer; font-size: 0.9rem; transition: 0.2s; }
        .length-selector input { display: none; }
        .length-selector input:checked + span { background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); color: var(--primary); font-weight: bold; display: block; border-radius: 16px; padding: 4px 8px; }
        .length-selector span { display: block; }
        
        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; transition: all 0.3s ease; }
        @media (min-width: 600px) { .grid-container { grid-template-columns: repeat(5, 1fr); } }
        
        .category-btn { background: white; border: 1px solid #e0e0e0; padding: 15px 5px; border-radius: 12px; font-size: 1rem; cursor: pointer; font-weight: 500; color: #444; box-shadow: 0 2px 4px rgba(0,0,0,0.02); transition: all 0.2s; }
        .category-btn:hover { transform: translateY(-2px); border-color: var(--primary); }
        .category-btn.active { background-color: var(--primary); color: white; border-color: var(--primary); }

        .dynamic-section { background: #f8f9fa; padding: 15px; border-radius: 12px; display: none; border: 1px solid #eee; animation: fadeIn 0.3s ease; }
        .sub-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }
        .holidays-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        
        .sub-btn { background: white; border: 1px solid #ccc; padding: 12px; border-radius: 10px; font-size: 0.95rem; cursor: pointer; transition: 0.2s; }
        .sub-btn.active { background: var(--primary-dark); color: white; border-color: var(--primary-dark); font-weight: bold; }

        .input-row { display: flex; gap: 10px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        
        .generate-btn { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border: none; padding: 16px; border-radius: 12px; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-top: 10px; }
        .generate-btn:active { transform: scale(0.98); }
        .generate-btn:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; }
        
        /* --- עיצוב אזור הפלט (שורות נפרדות) --- */
        .output-container { 
            background: #fff9c4; 
            padding: 15px; 
            border-radius: 12px; 
            min-height: 80px; 
            border: 1px dashed #fbc02d; 
            font-size: 1.1rem; 
            line-height: 1.5; 
            margin-top: 15px; 
        }

        .line-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 10px;
            animation: fadeIn 0.3s ease;
        }

        .line-text {
            flex: 1;
            padding: 4px 8px;
            border-radius: 8px;
            border: 1px solid transparent;
            transition: all 0.2s;
            cursor: text;
        }
        
        .line-text:focus {
            background: white;
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .delete-line-btn {
            background: #ef5350;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
            opacity: 0.7;
        }
        
        .delete-line-btn:hover { opacity: 1; transform: scale(1.1); }

        /* ------------------------------------------- */
        
        .actions-bar { display: flex; gap: 10px; margin-top: 10px; }
        .action-btn { flex: 1; padding: 12px; border: none; border-radius: 12px; font-size: 1rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-copy { background: #e4e6eb; color: #1c1e21; }
        .btn-whatsapp { background: var(--whatsapp); color: white; }
        
        #loadingOverlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.95); z-index: 100; display: flex; justify-content: center; align-items: center; flex-direction: column; border-radius: 16px; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-text { font-size: 1.1rem; color: #555; font-weight: bold; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div id="loadingOverlay">
        <div class="spinner"></div>
        <span class="loading-text">טוען אלפי ברכות מהענן...</span>
        <span id="loadingStatus" style="font-size:0.9rem; color:#888; margin-top:5px;">מתחבר לשרת...</span>
    </div>

    <h1>מפעל הברכות 🚀</h1>

    <div class="controls-area">
        <div class="top-row">
            <div class="sender-toggle">
                <button class="sender-btn active" id="senderMale" onclick="setSenderGender('male')">גבר 👨</button>
                <button class="sender-btn" id="senderFemale" onclick="setSenderGender('female')">אישה 👩</button>
            </div>

            <div class="length-wrapper">
                <span class="length-label-title">ברכה</span>
                <div class="length-selector">
                    <label><input type="radio" name="length" value="short" onchange="setLength('short')"><span>קצרה</span></label>
                    <label><input type="radio" name="length" value="long" onchange="setLength('long')" checked><span>ארוכה</span></label>
                </div>
            </div>

            <button class="emoji-btn active" id="emojiBtn" onclick="toggleEmoji()">
                <span id="emojiIcon">✅</span> אימוג'י
            </button>
        </div>
    </div>

    <button class="back-btn" id="backBtn" onclick="goBack()">🔙 חזרה לתפריט הראשי</button>

    <div class="grid-container" id="mainGrid">
        <button class="category-btn" style="background:#e0f7fa; border-color:#00bcd4;" onclick="selectCategory('morning_evening', this)">בוקר/ערב ☀️🌙</button>
        <button class="category-btn" onclick="selectCategory('shabbat', this)">שבת / מוצ"ש 🕯️</button>
        <button class="category-btn" onclick="selectCategory('holiday', this)">חג 🍷</button>
        <button class="category-btn" style="background:#fff9c4; border-color:#fbc02d;" onclick="selectCategory('chabad', this)">חב"ד 👑</button>
        <button class="category-btn" onclick="selectCategory('birthday', this)">יום הולדת 🎂</button>
        <button class="category-btn" onclick="selectCategory('event', this)">אירוע 💍</button>
        <button class="category-btn" onclick="selectCategory('birth', this)">לידה 👶</button>
        <button class="category-btn" onclick="selectCategory('recovery', this)">רפואה 💊</button>
        <button class="category-btn" onclick="selectCategory('thank_you', this)">תודה 🙏</button>
        <button class="category-btn" onclick="selectCategory('success', this)">הצלחה 🏆</button>
        <button class="category-btn" onclick="selectCategory('love', this)">אהבה ❤️</button>
    </div>

    <div id="morningEveningSection" class="dynamic-section">
        <div id="timeOfDaySelector">
            <h3>מה השעה?</h3>
            <div class="sub-grid" style="grid-template-columns: repeat(3, 1fr);">
                <button class="sub-btn" onclick="selectTimeOfDay('morning', this)">בוקר טוב ☀️</button>
                <button class="sub-btn" onclick="selectTimeOfDay('noon', this)">צהריים טובים 🌤️</button>
                <button class="sub-btn" onclick="selectTimeOfDay('night', this)">לילה טוב 🌙</button>
            </div>
        </div>
        <div id="timeTargetSelector" style="display:none; margin-top:15px;">
            <h3>למי הברכה?</h3>
            <div class="sub-grid">
                <button class="sub-btn" onclick="selectTimeTarget('general', this)">כללי ✨</button>
                <button class="sub-btn" onclick="selectTimeTarget('husband', this)">לבעלי 🤵</button>
                <button class="sub-btn" onclick="selectTimeTarget('wife', this)">לאשתי 👰</button>
            </div>
        </div>
    </div>

    <div id="shabbatSection" class="dynamic-section">
        <div id="shabbatTimeSelector">
            <h3>מה הזמן עכשיו?</h3>
            <div class="sub-grid">
                <button class="sub-btn" onclick="selectShabbatTime('shabbat')">🕯️ לקראת שבת</button>
                <button class="sub-btn" onclick="selectShabbatTime('motzash')">🎸 מוצאי שבת</button>
            </div>
        </div>
        <div id="shabbatTargetSelector" style="display:none;">
            <h3 id="shabbatTargetTitle">למי הברכה?</h3>
            <div class="sub-grid">
                <button class="sub-btn" onclick="selectSub('general', this)">כללי ✨</button>
                <button class="sub-btn" onclick="selectSub('family', this)">למשפחה 🏠</button>
                <button class="sub-btn" onclick="selectSub('wife', this)">לאשתי 👰</button>
                <button class="sub-btn" onclick="selectSub('husband', this)">לבעלי 🤵</button>
                <button class="sub-btn" onclick="selectSub('parents', this)">להורים 👴👵</button>
                <button class="sub-btn" onclick="selectSub('kids', this)">לילדים 🧸</button>
                <button class="sub-btn" onclick="selectSub('brother', this)">לאח 👦</button>
                <button class="sub-btn" onclick="selectSub('sister', this)">לאחות 👧</button>
                <button class="sub-btn" onclick="selectSub('friend_male', this)">לחבר 🤜🤛</button>
                <button class="sub-btn" onclick="selectSub('friend_female', this)">לחברה 👯‍♀️</button>
            </div>
        </div>
    </div>

    <div id="holidaySection" class="dynamic-section">
        <div id="holidayNameSelector">
            <h3>איזה חג חוגגים?</h3>
            <div class="holidays-grid">
                <button class="sub-btn" style="background:#e3f2fd; border-color:#2196f3; font-weight:bold;" onclick="selectHolidayName('rosh_chodesh', this)">ראש חודש 🌑</button>
                <button class="sub-btn" onclick="selectHolidayName('rosh_hashanah', this)">ר"השנה 🍎</button>
                <button class="sub-btn" onclick="selectHolidayName('yom_kippur', this)">כיפור ⚖️</button>
                <button class="sub-btn" onclick="selectHolidayName('sukkot', this)">סוכות 🌿</button>
                <button class="sub-btn" onclick="selectHolidayName('simchat_torah', this)">שמחת תורה 📜</button>
                <button class="sub-btn" onclick="selectHolidayName('hanukkah', this)">חנוכה 🕎</button>
                <button class="sub-btn" onclick="selectHolidayName('tu_bishvat', this)">ט"ו בשבט 🌳</button>
                <button class="sub-btn" onclick="selectHolidayName('purim', this)">פורים 🎭</button>
                <button class="sub-btn" onclick="selectHolidayName('passover', this)">פסח 🍷</button>
                <button class="sub-btn" onclick="selectHolidayName('mimouna', this)">מימונה 🥞</button>
                <button class="sub-btn" onclick="selectHolidayName('yom_haatzmaut', this)">העצמאות 🇮🇱</button>
                <button class="sub-btn" onclick="selectHolidayName('lag_baomer', this)">ל"ג בעומר 🔥</button>
                <button class="sub-btn" onclick="selectHolidayName('shavuot', this)">שבועות 🌾</button>
                <button class="sub-btn" onclick="selectHolidayName('tu_beav', this)">ט"ו באב ❤️</button>
                <button class="sub-btn" onclick="selectHolidayName('generic_holiday', this)">כללי 🎉</button>
            </div>
        </div>
        
        <div id="holidayTargetSelector" style="display:none; margin-top:15px;">
            <h3>למי ברכת החג?</h3>
            <div class="sub-grid">
                <button class="sub-btn" onclick="selectHolidayTarget('general', this)">כללי ✨</button>
                <button class="sub-btn" onclick="selectHolidayTarget('family', this)">למשפחה 🏠</button>
                <button class="sub-btn" onclick="selectHolidayTarget('wife', this)">לאשתי 👰</button>
                <button class="sub-btn" onclick="selectHolidayTarget('husband', this)">לבעלי 🤵</button>
                <button class="sub-btn" onclick="selectHolidayTarget('parents', this)">להורים 👴👵</button>
                <button class="sub-btn" onclick="selectHolidayTarget('kids', this)">לילדים 🧸</button>
                <button class="sub-btn" onclick="selectHolidayTarget('brother', this)">לאח 👦</button>
                <button class="sub-btn" onclick="selectHolidayTarget('sister', this)">לאחות 👧</button>
                <button class="sub-btn" onclick="selectHolidayTarget('friend_male', this)">לחבר 🤜🤛</button>
                <button class="sub-btn" onclick="selectHolidayTarget('friend_female', this)">לחברה 👯‍♀️</button>
                <button class="sub-btn" onclick="selectHolidayTarget('group', this)">לקבוצה 👨‍👩‍👧‍👦</button>
            </div>
        </div>
    </div>

    <div id="chabadSection" class="dynamic-section">
        <h3>תאריך חסידי</h3>
        <div class="holidays-grid">
            <button class="sub-btn" onclick="selectSub('chabad_19_kislev', this)">י"ט כסלו 📖</button>
            <button class="sub-btn" onclick="selectSub('chabad_10_shevat', this)">י' שבט 🕯️</button>
            <button class="sub-btn" onclick="selectSub('chabad_11_nissan', this)">י"א ניסן 👑</button>
            <button class="sub-btn" onclick="selectSub('chabad_3_tammuz', this)">ג' תמוז 🕯️</button>
            <button class="sub-btn" onclick="selectSub('chabad_12_tammuz', this)">י"ב-י"ג תמוז 🔓</button>
            <button class="sub-btn" onclick="selectSub('chabad_18_elul', this)">ח"י אלול ✨</button>
            <button class="sub-btn" onclick="selectSub('chabad_5_tevet', this)">ה' טבת 📚</button>
            <button class="sub-btn" onclick="selectSub('chabad_22_shevat', this)">כ"ב שבט 🕯️</button>
            <button class="sub-btn" onclick="selectSub('chabad_24_tevet', this)">כ"ד טבת 📜</button>
            <button class="sub-btn" onclick="selectSub('chabad_14_kislev', this)">י"ד כסלו 💍</button>
            <button class="sub-btn" onclick="selectSub('chabad_2_iyar', this)">ב' אייר 🚀</button>
            <button class="sub-btn" onclick="selectSub('chabad_6_tishrei', this)">ו' תשרי 🕯️</button>
        </div>
        
        <h3 style="margin-top:15px;">למי הברכה?</h3>
        <div class="sub-grid">
            <button class="sub-btn" onclick="selectSub('general', this)">כללי</button>
            <button class="sub-btn" onclick="selectSub('family', this)">למשפחה</button>
        </div>
    </div>

    <div id="eventSection" class="dynamic-section">
        <h3>איזה אירוע חוגגים?</h3>
        <div class="sub-grid">
            <button class="sub-btn" onclick="selectSub('wedding', this)">חתונה 💍</button>
            <button class="sub-btn" onclick="selectSub('bar_mitzvah', this)">בר מצווה 🕍</button>
            <button class="sub-btn" onclick="selectSub('bat_mitzvah', this)">בת מצווה 🌸</button>
            <button class="sub-btn" onclick="selectSub('brit_milah', this)">ברית מילה 👶</button>
            <button class="sub-btn" onclick="selectSub('brita', this)">בריתה 🎀</button>
            <button class="sub-btn" onclick="selectSub('housewarming', this)">חנוכת בית 🔑</button>
            <button class="sub-btn" onclick="selectSub('henna', this)">חינה 🤚</button>
        </div>
    </div>

    <div id="birthSection" class="dynamic-section">
        <h3>מזל טוב! מה נולד?</h3>
        <div class="sub-grid">
            <button class="sub-btn" onclick="selectSub('birth_boy', this)">לידת בן 💙👶</button>
            <button class="sub-btn" onclick="selectSub('birth_girl', this)">לידת בת 💖👶</button>
        </div>
    </div>

    <div id="genderSection" class="dynamic-section">
         <h3>למי הברכה?</h3>
         <div class="sub-grid">
             <button class="sub-btn" onclick="selectGenderGeneral('male', this)">לבעלי / בן זוגי 🤵</button>
             <button class="sub-btn" onclick="selectGenderGeneral('female', this)">לאשתי / בת זוגתי 👰</button>
         </div>
    </div>

    <div id="birthdaySection" class="dynamic-section">
        <h3>למי יום ההולדת?</h3>
        <div class="sub-grid" style="grid-template-columns: repeat(4, 1fr);">
            <button class="sub-btn" onclick="selectGender('man', this)">גבר 👨</button>
            <button class="sub-btn" onclick="selectGender('woman', this)">אישה 👩</button>
            <button class="sub-btn" onclick="selectGender('boy', this)">ילד 👦</button>
            <button class="sub-btn" onclick="selectGender('girl', this)">ילדה 👧</button>
        </div>
        <div id="relationsContainer" style="display:none; margin-top:10px;">
            <div class="sub-grid" id="relationsGrid" style="grid-template-columns: repeat(3, 1fr);"></div>
        </div>
    </div>
    
    <div id="inputSection" class="dynamic-section" style="display:none;">
        <div class="input-row">
            <input type="text" id="nameInput" placeholder="שם (אופציונלי)" list="nameHistory">
            <datalist id="nameHistory"></datalist>
            <input type="number" id="ageInput" placeholder="גיל (אופציונלי)">
        </div>
    </div>

    <button class="generate-btn" id="genBtn" onclick="generateBlessing()" style="display:none;">🎁 צור ברכה</button>
    
    <div class="output-container" id="output">
        <div style="opacity:0.5; text-align:center; padding-top:10px;">הברכה תופיע כאן...</div>
    </div>

    <div class="actions-bar">
        <button class="action-btn btn-copy" onclick="copyText()">📄 העתק</button>
        <button class="action-btn btn-whatsapp" onclick="sendWhatsapp()">שלח לווצאפ</button>
    </div>
</div>

<script>
    let generators = {};
    let state = { category: null, subCategory: null, shabbatTime: null, holidayName: null, holidayTarget: null, chabadDate: null, chabadTarget: null, timeOfDay: null, length: 'long', gender: null, relationKey: null, useEmojis: true, senderGender: 'male' };

    // --- מאגר חירום פנימי לגיבוי מיידי ---
    const localBlessings = {
        "birthday_partner_female": {
            "openers": ["בת הזוג האהובה,", "יקירתי,", "אהבת חיי,", "הנסיכה שלי,", "המלכה שלי,", "בת הזוג המושלמת,", "בת הזוג הנפלאה,", "אהובתי,", "חיימשלי,", "כוכבת שלי,", "האישה שלי,", "החברה הכי טובה שלי,", "אלופה שלי,", "הלב שלי,", "האחת והיחידה,", "החצי השני,", "בת הזוג המוצלחת,", "המתוקה שלי,", "בת הזוג האדירה,", "המצפן שלי,", "האור של חיי,", "העוגן שלי,", "כל עולמי,", "אהובתי הנצחית,"],
            "bodies": ["אין מילים לתאר כמה את חשובה לי.", "מאחל לך שכל יום יהיה יפה וזוהר כמו החיוך שלך.", "שתזכי לנוח, להנות, להתפנק ולהגשים את עצמך השנה.", "את הלב של הבית, תודה על כל מה שאת עושה ועל מי שאת.", "אוהב אותך יותר בכל שנה שעוברת, את משתבחת עם הזמן.", "מאחל לך בריאות איתנה, כוחות ושמחת חיים אינסופית.", "את האישה הכי מדהימה בעולם, ואני זכיתי בך.", "שתהיה לך שנה של הגשמת חלומות, סיפוק והנאה.", "תודה שאת בת הזוג הכי טובה שיכולתי לבקש.", "מאחל לך שתמיד תהיי מאושרת ושהעיניים שלך ינצצו משמחה.", "את החצי השני שלי, המשלימה שלי והחברה הכי טובה שלי.", "יום הולדת שמח! מגיע לך את כל הטוב שבעולם.", "שתהיה שנה של פריחה, יופי וסטייל.", "מאחל לך שקט נפשי, רוגע ושלווה.", "את הכוח המניע שלי, תודה על הכל.", "יום הולדת שמח אהובה! אני אוהב אותך עד השמיים.", "שתהיה שנה של הצלחות קטנות וגדולות.", "מאחל לך שתמיד תרגישי אהובה, רצויה ומוערכת.", "את המתנה הכי טובה שקיבלתי בחיים.", "יום הולדת שמח למלכה שלי! אני אעשה הכל בשבילך.", "שתהיה שנה של טיולים, חוויות ורומנטיקה.", "מאחל לך שתגשימי את כל היעדים שלך בקריירה ובחיים.", "את ההשראה שלי לכל דבר טוב.", "יום הולדת שמח! תעשי חיים ותחגגי כמו שצריך.", "שתהיה שנה מלאה בהפתעות טובות ובשורות משמחות.", "אני מעריץ אותך על מי שאת.", "מאחל לך שתמיד תהיי בריאה וחזקה.", "את האור שלי, מזל טוב.", "יום הולדת שמח יפה שלי! את פשוט מושלמת.", "שתהיה שנה של צחוק, חברות טובות וכיף.", "מאחל לך שפע גשמי ורוחני.", "את האוצר שלי, תודה שאת שלי.", "יום הולדת שמח! את כל עולמי.", "שתזכי לחיים ארוכים ומאושרים לצידי.", "מאחל לך שנה של התחדשות ורעננות.", "את הדבר הכי יקר לי.", "יום הולדת שמח אהובתי הנצחית.", "שתהיה שנה של אהבה פורחת.", "מאחל לך שתמיד תחייכי.", "את נותנת לי סיבה לקום בבוקר.", "יום הולדת שמח! אני אוהב אותך בטירוף.", "שתהיה שנה של ברכה והצלחה.", "מאחל לך את כל האושר שבעולם.", "את הנס הפרטי שלי.", "יום הולדת שמח! תהני מהיום שלך.", "שתהיה שנה מדהימה.", "מאחל לך רק טוב.", "אוהב אותך לנצח."],
            "closings": ["אוהב אותך.", "שלך תמיד.", "מזל טוב יפה שלי.", "בן זוגך האוהב.", "נשיקות.", "באהבה ענקית.", "שלך לנצח.", "מזל טוב!", "עד 120!", "יום הולדת שמח."]
        },
        "birthday_partner_male": {
            "openers": ["בן הזוג האהוב,", "יקירי,", "אהבת חיי,", "הנסיך שלי,", "המלך שלי,", "בן הזוג המושלם,", "בן הזוג הנפלא,", "אהובי,", "חיימי,", "כוכב שלי,", "הגבר שלי,", "החבר הכי טוב שלי,", "אלוף שלי,", "הלב שלי,", "האחד והיחיד,", "החצי השני,", "בן הזוג המוצלח,", "המתוק שלי,", "בן הזוג האדיר,", "המצפן שלי,", "העוגן שלי,", "המשענת שלי,", "כל עולמי,", "אהובי הנצחי,", "הגבר של חיי,"],
            "bodies": ["אתה המתנה הכי גדולה שקיבלתי בחיים, תודה שאתה שלי.", "מאחלת לך את כל הטוב שבעולם, כי מגיע לך הכל ויותר.", "תודה שאתה בן הזוג הכי תומך ואוהב בעולם.", "שתהיה לך שנה של הגשמת שאיפות והצלחות מסחררות בעבודה ובחיים.", "אוהבת להזדקן איתך, עד 120 ביחד בבריאות ובנחת.", "אתה העוגן שלי, המשענת שלי והחבר הכי טוב שלי.", "מאחלת לך שפע של בריאות, כוח ושמחת חיים שלא נגמרת.", "שתזכה לראות ברכה בכל מעשה ידיך.", "יום הולדת שמח לגבר שעושה אותי מאושרת בכל יום מחדש.", "שתהיה השנה הזו טובה יותר מכל קודמותיה.", "אני מעריצה את החוכמה שלך, את הטוב לב שלך ואת מי שאתה.", "מאחלת לך שתמיד תחייך, כי החיוך שלך הוא האור שלי.", "שכל משאלות ליבך יתגשמו לטובה ולברכה.", "אתה הגיבור שלי, המגן שלי והאהבה שלי.", "יום הולדת שמח! תמשיך להיות כזה מושלם.", "שתזכה לשנה של שקט נפשי, רוגע וסיפוק.", "תודה על כל מה שאתה עושה למעננו.", "מאחלת לך שנה של פריצת דרך והגעה לשיאים חדשים.", "אתה החצי השני שלי, ואני לא שלמה בלעדיך.", "יום הולדת שמח אהובי! אני אוהבת אותך עד הירח וחזרה.", "שתהיה לך שנה מלאה בחוויות טובות, טיולים וזמן איכות.", "אתה המודל לחיקוי שלי וגאוות ליבי.", "מאחלת לך שפע גשמי ורוחני.", "שתישאר צעיר לנצח ברוח ובנפש.", "יום הולדת שמח! תעשה חיים ותהנה מהיום שלך.", "שתמיד תהיה בריא וחזק כמו אריה.", "אתה המלך של הממלכה שלנו.", "מאחלת לך שנה של אהבה בוערת וזוגיות פורחת.", "שתזכה להגשים את כל החלומות שלך, גם הקטנים.", "יום הולדת שמח לגבר הכי סקסי בעולם.", "תודה שאתה החבר הכי טוב שלי.", "מאחלת לך שנה של נחת ושלווה.", "שתהיה שנה של בשורות טובות והפתעות נעימות.", "אתה כל עולמי, מזל טוב.", "יום הולדת שמח! אתה האוצר שלי.", "שתזכה לחיים ארוכים ומאושרים לצידי.", "מאחלת לך שתמיד תרגיש אהוב ומוערך.", "שכל יום איתך יהיה חגיגה.", "יום הולדת שמח אהובי הנצחי.", "שתהיה שנה של הצלחה עסקית וכלכלית.", "אתה האור של הבית.", "מאחלת לך שתמיד תהיה מוקף בחברים טובים.", "שתישאר בדיוק כמו שאתה, כי ככה אני אוהבת אותך.", "יום הולדת שמח! אתה פשוט וואו.", "שתהיה שנה של צחוק והנאה.", "מאחלת לך בריאות איתנה.", "אתה הלב שלי.", "מזל טוב לגבר של חיי.", "שתהיה שנה מבורכת.", "אני אוהבת אותך בלי סוף."],
            "closings": ["אוהבת אותך.", "שלך לנצח.", "מזל טוב חיים שלי.", "נשיקות.", "בת זוגתך האוהבת.", "באהבה ענקית.", "שלך תמיד.", "מזל טוב!", "עד 120!", "יום הולדת שמח."]
        },
        "birthday_wife": {
            "openers": ["אשתי האהובה,", "יקירתי,", "אהבת חיי,", "הנסיכה שלי,", "המלכה שלי,", "אשתי המושלמת,", "אשתי היקרה,", "אהובתי,", "חיימשלי,", "כוכבת שלי,", "האישה שלי,", "החברה הכי טובה שלי,", "אלופה שלי,", "הלב שלי,", "האחת והיחידה,", "החצי השני,", "אשתי המוצלחת,", "המתוקה שלי,", "המצפן שלי,", "האור של חיי,", "העוגן שלי,", "כל עולמי,", "אהובתי הנצחית,", "האישה של חיי,"],
            "bodies": ["אין מילים לתאר כמה את חשובה לי.", "מאחל לך שכל יום יהיה יפה וזוהר כמו החיוך שלך.", "שתזכי לנוח, להנות, להתפנק ולהגשים את עצמך השנה.", "את הלב של הבית, תודה על כל מה שאת עושה ועל מי שאת.", "אוהב אותך יותר בכל שנה שעוברת, את משתבחת עם הזמן.", "מאחל לך בריאות איתנה, כוחות ושמחת חיים אינסופית.", "את האישה הכי מדהימה בעולם, ואני זכיתי בך.", "שתהיה לך שנה של הגשמת חלומות, סיפוק והנאה.", "תודה שאת האישה הכי טובה שיכולתי לבקש.", "מאחל לך שתמיד תהיי מאושרת ושהעיניים שלך ינצצו משמחה.", "את החצי השני שלי, המשלימה שלי והחברה הכי טובה שלי.", "יום הולדת שמח! מגיע לך את כל הטוב שבעולם.", "שתהיה שנה של פריחה, יופי וסטייל.", "מאחל לך שקט נפשי, רוגע ושלווה.", "את הכוח המניע שלי, תודה על הכל.", "יום הולדת שמח אהובה! אני אוהב אותך עד השמיים.", "שתהיה שנה של הצלחות קטנות וגדולות.", "מאחל לך שתמיד תרגישי אהובה, רצויה ומוערכת.", "את המתנה הכי טובה שקיבלתי בחיים.", "יום הולדת שמח למלכה שלי! אני אעשה הכל בשבילך.", "שתהיה שנה של טיולים, חוויות ורומנטיקה.", "מאחל לך שתגשימי את כל היעדים שלך בקריירה ובחיים.", "את ההשראה שלי לכל דבר טוב.", "יום הולדת שמח! תעשי חיים ותחגגי כמו שצריך.", "שתהיה שנה מלאה בהפתעות טובות ובשורות משמחות.", "אני מעריץ אותך על מי שאת.", "מאחל לך שתמיד תהיי בריאה וחזקה.", "את האור שלי, מזל טוב.", "יום הולדת שמח יפה שלי! את פשוט מושלמת.", "שתהיה שנה של צחוק, חברות טובות וכיף.", "מאחל לך שפע גשמי ורוחני.", "את האוצר שלי, תודה שאת שלי.", "יום הולדת שמח! את כל עולמי.", "שתזכי לחיים ארוכים ומאושרים לצידי.", "מאחל לך שנה של התחדשות ורעננות.", "את הדבר הכי יקר לי.", "יום הולדת שמח אהובתי הנצחית.", "שתהיה שנה של אהבה פורחת.", "מאחל לך שתמיד תחייכי.", "את נותנת לי סיבה לקום בבוקר.", "יום הולדת שמח! אני אוהב אותך בטירוף.", "שתהיה שנה של ברכה והצלחה.", "מאחל לך את כל האושר שבעולם.", "את הנס הפרטי שלי.", "יום הולדת שמח! תהני מהיום שלך.", "שתהיה שנה מדהימה.", "מאחל לך רק טוב.", "אוהב אותך לנצח."],
            "closings": ["אוהב אותך.", "שלך תמיד.", "מזל טוב יפה שלי.", "בעלך האוהב.", "נשיקות.", "באהבה ענקית.", "שלך לנצח.", "מזל טוב!", "עד 120!", "יום הולדת שמח."]
        },
        "birthday_husband": {
            "openers": ["בעלי האהוב,", "יקירי,", "אהבת חיי,", "הנסיך שלי,", "המלך שלי,", "בעלי המושלם,", "בעלי היקר,", "אהובי,", "חיימי,", "כוכב שלי,", "הגבר שלי,", "החבר הכי טוב שלי,", "אלוף שלי,", "הלב שלי,", "האחד והיחיד,", "החצי השני,", "בעלי המוצלח,", "המתוק שלי,", "המצפן שלי,", "העוגן שלי,", "המשענת שלי,", "כל עולמי,", "אהובי הנצחי,", "הגבר של חיי,"],
            "bodies": ["אתה המתנה הכי גדולה שקיבלתי בחיים, תודה שאתה שלי.", "מאחלת לך את כל הטוב שבעולם, כי מגיע לך הכל ויותר.", "תודה שאתה הבעל הכי תומך ואוהב בעולם.", "שתהיה לך שנה של הגשמת שאיפות והצלחות מסחררות בעבודה ובחיים.", "אוהבת להזדקן איתך, עד 120 ביחד בבריאות ובנחת.", "אתה העוגן שלי, המשענת שלי והחבר הכי טוב שלי.", "מאחלת לך שפע של בריאות, כוח ושמחת חיים שלא נגמרת.", "שתזכה לראות ברכה בכל מעשה ידיך.", "יום הולדת שמח לגבר שעושה אותי מאושרת בכל יום מחדש.", "שתהיה השנה הזו טובה יותר מכל קודמותיה.", "אני מעריצה את החוכמה שלך, את הטוב לב שלך ואת מי שאתה.", "מאחלת לך שתמיד תחייך, כי החיוך שלך הוא האור שלי.", "שכל משאלות ליבך יתגשמו לטובה ולברכה.", "אתה הגיבור שלי, המגן שלי והאהבה שלי.", "יום הולדת שמח! תמשיך להיות כזה מושלם.", "שתזכה לשנה של שקט נפשי, רוגע וסיפוק.", "תודה על כל מה שאתה עושה למעננו.", "מאחלת לך שנה של פריצת דרך והגעה לשיאים חדשים.", "אתה החצי השני שלי, ואני לא שלמה בלעדיך.", "יום הולדת שמח אהובי! אני אוהבת אותך עד הירח וחזרה.", "שתהיה לך שנה מלאה בחוויות טובות, טיולים וזמן איכות.", "אתה המודל לחיקוי שלי וגאוות ליבי.", "מאחלת לך שפע גשמי ורוחני.", "שתישאר צעיר לנצח ברוח ובנפש.", "יום הולדת שמח! תעשה חיים ותהנה מהיום שלך.", "שתמיד תהיה בריא וחזק כמו אריה.", "אתה המלך של הממלכה שלנו.", "מאחלת לך שנה של אהבה בוערת וזוגיות פורחת.", "שתזכה להגשים את כל החלומות שלך, גם הקטנים.", "יום הולדת שמח לגבר הכי סקסי בעולם.", "תודה שאתה החבר הכי טוב שלי.", "מאחלת לך שנה של נחת ושלווה.", "שתהיה שנה של בשורות טובות והפתעות נעימות.", "אתה כל עולמי, מזל טוב.", "יום הולדת שמח! אתה האוצר שלי.", "שתזכה לחיים ארוכים ומאושרים לצידי.", "מאחלת לך שתמיד תרגיש אהוב ומוערך.", "שכל יום איתך יהיה חגיגה.", "יום הולדת שמח אהובי הנצחי.", "שתהיה שנה של הצלחה עסקית וכלכלית.", "אתה האור של הבית.", "מאחלת לך שתמיד תהיה מוקף בחברים טובים.", "שתישאר בדיוק כמו שאתה, כי ככה אני אוהבת אותך.", "יום הולדת שמח! אתה פשוט וואו.", "שתהיה שנה של צחוק והנאה.", "מאחלת לך בריאות איתנה.", "אתה הלב שלי.", "מזל טוב לגבר של חיי.", "שתהיה שנה מבורכת.", "אני אוהבת אותך בלי סוף."],
            "closings": ["אוהבת אותך.", "שלך לנצח.", "מזל טוב חיים שלי.", "נשיקות.", "אשתך האוהבת.", "באהבה ענקית.", "שלך תמיד.", "מזל טוב!", "עד 120!", "יום הולדת שמח."]
        },
         "birthday_mom": {
            "openers": ["אמא יקרה,", "אמא אהובה,", "המלכה של הבית,", "אמאלה שלי,", "האור של חיי,", "עמוד התווך,", "הנשמה שלי,", "אמא המושלמת,", "החברה הכי טובה שלי,", "המלאך השומר שלי,", "אמא מספר אחת,", "מקור ההשראה,", "הלב הענק,", "אמא היקרה מכל,", "אשת חיל,", "אמא האלופה,", "הבשלנית הכי טובה,", "היועצת שלי,", "המרגיעה הלאומית,", "אמא הכי יפה בעולם,", "המתנה של חיי,", "מפעל של אהבה,", "אמא יקרה שלי,", "אהבת חיי,", "אמא'לה,"],
            "bodies": ["מזל טוב לאמא הכי טובה בעולם! אין כמוך.", "תודה על כל הנתינה, האהבה והדאגה האינסופית.", "מאחלים לך בריאות איתנה, נחת מהילדים ומהנכדים.", "שתמיד תהיי מאושרת, שמחה ומוקפת באהבה.", "את הלב של המשפחה שלנו, הדבק שמחזיק את כולנו יחד.", "יום הולדת שמח! שיתגשמו כל משאלות ליבך לטובה.", "שתזכי לשנים ארוכות ויפות של עשייה וסיפוק.", "אמא יקרה, תודה שאת תמיד שם בשבילנו, בכל שעה.", "מאחלים לך שתנוחי קצת ותדאגי גם לעצמך.", "שתהיה לך שנה של טיולים, הנאות וזמן איכות.", "אין מילים לתאר כמה אנחנו אוהבים ומעריכים אותך.", "את המודל לחיקוי שלי, האישה הכי חזקה שאני מכיר/ה.", "שיהיה לך יום הולדת שמח ומלא בפרחים וחיבוקים.", "שתזכי לראות ברכה בכל מעשה ידיך.", "שהשמחה תמיד תשכון בליבך ובביתך.", "אנחנו זכינו באמא הכי מדהימה שיש.", "מאחלים לך שקט נפשי, רוגע ושלווה.", "שתמיד תהיי עטופה בחום ובאהבה שלנו.", "יום הולדת שמח! את פשוט מלאך בדמות אדם.", "שתהיה שנה של בשורות טובות והתחלות חדשות."],
            "closings": ["אוהבים אותך המון.", "הילדים.", "מזל טוב אמא.", "נשיקות.", "שלך תמיד.", "באהבה.", "עד 120!", "יום הולדת שמח!"]
        },
         "birthday_dad": {
            "openers": ["אבא יקר,", "אבא אהוב,", "המלך של הבית,", "אבאלה שלי,", "האור של חיי,", "עמוד התווך,", "הנשמה שלי,", "אבא המושלם,", "החבר הכי טוב שלי,", "המלאך השומר שלי,", "אבא מספר אחת,", "מקור ההשראה,", "הלב הענק,", "אבא היקר מכל,", "איש חיל,", "אבא האלוף,", "המנטור שלי,", "היועץ שלי,", "המרגיע הלאומי,", "אבא הכי חזק בעולם,", "המתנה של חיי,", "מודל לחיקוי,", "אבא יקר שלי,", "אהבת חיי,", "אבא'לה,"],
            "bodies": ["מזל טוב לאבא הכי טוב בעולם! אתה הגיבור שלי.", "תודה על כל מה שאתה עושה למעננו, על העבודה הקשה וההשקעה.", "מאחלים לך בריאות איתנה, כוח ושמחת חיים.", "שתמיד תהיה מאושר וגאה במשפחה שבנית.", "אתה העוגן שלנו, היציבות והביטחון של הבית.", "יום הולדת שמח! שכל חלומותיך יתגשמו.", "שתזכה לשנים רבות של נחת, הצלחה ושגשוג.", "אבא יקר, תודה שאתה תמיד שם לכוון ולייעץ.", "מאחלים לך שתמצא זמן גם לתחביבים ולעצמך.", "שתהיה לך שנה של שקט, רוגע ומנוחה.", "אנחנו אוהבים אותך ומעריכים אותך בלי סוף.", "אתה המודל לחיקוי שלי, הגבר שאני שואף/ת להיות.", "שיהיה לך יום הולדת שמח עם המון פינוקים.", "שתזכה לראות פירות בעמלך וברכה בכספך.", "שהחיוך שלך תמיד יאיר לנו את הדרך.", "זכינו באבא מדהים, חכם וטוב לב.", "מאחלים לך את כל הטוב שבעולם, מגיע לך.", "שתמיד תהיה מוקף באהבה וכבוד.", "יום הולדת שמח! אתה פשוט אגדה.", "שתהיה שנה של בשורות טובות."],
            "closings": ["אוהבים אותך אבא.", "הילדים.", "מזל טוב.", "חיבוק ענק.", "שלך תמיד.", "באהבה.", "עד 120!", "יום הולדת שמח!"]
        },
        "birthday_son": {
            "openers": ["לבן האהוב,", "נסיך החלומות,", "היורש שלנו,", "כוכב הצפון,", "הבן המושלם,", "גאוות חיי,", "הלב של המשפחה,", "המתוק שלנו,", "האלוף הפרטי,", "הבן יקר מכל,", "הנשמה שלי,", "העתיד שלי,", "מלך החיים,", "האושר של אמא ואבא,", "הבן של המלך,", "המצחיק של הבית,", "הילד החזק,", "הבן המוצלח,", "המתנה הכי גדולה,", "הבן יקר ואהוב,", "ילד הפלא,", "האור של הבית,", "הנסיך הקטן,", "אהבת חיי,", "ילד של אמא ואבא,"],
            "bodies": ["איזה כיף שגדלת בשנה! מאחלים לך המון מתנות וכיף.", "שתהיה תמיד ילד שמח, חכם ואהוב על כולם.", "הרבה הצלחה בלימודים, במשחקים ועם החברים.", "שתגדל להיות צדיק, משמח את ההורים ומאיר פנים.", "יום הולדת של ממתקים, בלונים, עוגה טעימה והפתעות.", "מאחלים לך שתמיד תחלום בגדול ותגשים את החלומות.", "אוהבים אותך עד השמיים וחזרה, ילד מתוק שלנו.", "שתהיה לך שנה של גולים, ניצחונות ומשחקים שווים.", "מזל טוב! שתקבל את כל המתנות שרצית.", "שתמיד תהיה מוקף בחברים טובים שאוהבים אותך.", "אתה הגאווה שלנו, תמשיך להיות ילד כזה נהדר.", "יום הולדת שמח! תהנה מהמסיבה ומהעוגה.", "שתגדל להיות חכם, חזק וגיבור.", "מאחלים לך שנה מלאה בצחוק ובחיוכים.", "שתצליח בלימודים ותהיה תלמיד מצטיין.", "מזל טוב לנסיך של הבית! אתה האור שלנו.", "שתהיה לך שנה של הרפתקאות וגילויים חדשים.", "אתה ילד מיוחד במינו, אל תשכח את זה אף פעם.", "יום הולדת שמח! שתמיד תהיה בריא ושמח.", "מאחלים לך שתמיד תמצא סיבות לחייך.", "שתגדל לתורה, לחופה ולמעשים טובים.", "מזל טוב חמוד! תמשיך לעשות לנו נחת.", "שתהיה לך שנה כייפית בבית הספר/בגן.", "אתה הילד הכי מצחיק וכיפי שאנחנו מכירים.", "יום הולדת שמח! תבקש משאלה ותכבה את הנרות.", "שתמיד תהיה אהוב על הבריות ועל המקום.", "מאחלים לך המון כיף, משחקים והנאות.", "שתגדל להיות מנהיג ומוביל.", "מזל טוב! שתמיד תהיה ראשון בהכל.", "שתהיה לך שנה מתוקה כמו סוכרייה.", "אתה המתנה הכי גדולה שקיבלנו.", "יום הולדת שמח! תעשה חיים משוגעים.", "שתמיד תהיה מוקף במשפחה אוהבת.", "מאחלים לך שתגדל ותפרח.", "שתהיה לך יום הולדת מהסרטים.", "מזל טוב גיבור על! אתה חזק ואמיץ.", "שתמיד תדע לבחור בטוב.", "יום הולדת שמח! תהנה מכל רגע.", "שתהיה שנה של חוויות חדשות.", "אתה הלב של המשפחה שלנו.", "מזל טוב! שתמיד תהיה שמח בחלקך.", "שתגדל להיות \"מענטש\" אמיתי.", "יום הולדת שמח! תמשיך לחייך את החיוך הממיס שלך.", "מאחלים לך שתצליח בכל מה שתעשה.", "שתהיה שנה של חברים חדשים וחוויות.", "מזל טוב! אתה פשוט ילד קסם.", "שתמיד תהיה בריא וחזק כמו אריה.", "יום הולדת שמח! אוהבים אותך המון.", "שתגדל להיות מקור גאווה לעם ישראל.", "מאחלים לך רק טוב ושמחה."],
            "closings": ["אוהבים אותך.", "אמא ואבא.", "מזל טוב נסיך.", "חיבוק ענק.", "שלך תמיד.", "באהבה.", "עד 120!", "נשיקות.", "יום הולדת שמח!"]
        },
        "birthday_daughter": {
            "openers": ["לבת האהובה,", "נסיכת החלומות,", "הפרח שלנו,", "מלכת היופי,", "הבת המושלמת,", "גאוות חיי,", "הלב של המשפחה,", "המתוקה שלנו,", "האמנית הפרטית,", "הבת יקרה מכל,", "הנשמה שלי,", "העתיד שלי,", "מלכת החיים,", "האושר של אמא ואבא,", "הבת של המלכה,", "המצחיקה של הבית,", "הילדה החכמה,", "הבת המוצלחת,", "המתנה הכי גדולה,", "הבת יקרה ואהובה,", "ילדת הפלא,", "האור של הבית,", "הנסיכה הקסומה,", "אהבת חיי,", "ילדה של אמא ואבא,"],
            "bodies": ["יום הולדת שמח לילדה הכי מקסימה בעולם כולו.", "שתהיה לך מסיבה כייפית עם עוגה, בלונים וחברות.", "מאחלים לך שתמיד תחייכי ותהיי מאושרת.", "הצלחה בלימודים והמון רגעים של כיף וצחוק.", "שתגדלי להיות נערה ואישה מדהימה, מקור גאווה לכולם.", "כל שתבקשי לו יהי, נסיכה קטנה שלנו.", "אוהבים אותך המון, את האור של הבית.", "שתהיה לך שנה ורודה, שמחה ומלאה בנצנצים.", "מזל טוב! שתקבלי המון מתנות שוות.", "את הפרח הכי יפה בגן שלנו, תמשיכי לפרוח.", "יום הולדת שמח! שתמיד תהיי מוקפת בחברות טובות.", "מאחלים לך שתהיי בריאה, חזקה ויפה.", "שתצליחי בלימודים ותהיי תלמידה לתפארת.", "מזל טוב יפה שלי! את פשוט מושלמת.", "שתהיה לך שנה של ריקודים, שירים ושמחה.", "את הילדה הכי טובה בעולם, מגיע לך הכל.", "יום הולדת שמח! תהני מהיום שלך כמו נסיכה אמיתית.", "שתגדלי להיות צדקת, חכמה וטובת לב.", "מאחלים לך שנה של חלומות מתוקים שמתגשמים.", "שתמיד תהיי אהובה על כולם.", "מזל טוב! את האושר של אמא ואבא.", "שתהיה לך שנה מלאה בחוויות וטיולים.", "את מכניסה לבית שלנו כל כך הרבה אור.", "יום הולדת שמח! תבקשי משאלה, היא בטוח תתגשם.", "שתגדלי לתורה, לחופה ולמעשים טובים.", "מאחלים לך המון רגעים של נחת וכיף.", "שתהיי תמיד שמחה בחלקך ומאושרת.", "מזל טוב! את פשוט בובה אמיתית.", "שתהיה לך שנה של יצירה ודמיון.", "את הלב של המשפחה, אוהבים אותך.", "יום הולדת שמח! תמשיכי להיות כזו מתוקה.", "מאחלים לך שתמיד תרגישי מלכה.", "שתצליחי בכל החוגים ובכל המשימות.", "מזל טוב! שתהיה לך שנה קסומה.", "שתמיד יהיה לך חיוך על הפנים.", "יום הולדת שמח לילדה הכי מוכשרת.", "מאחלים לך בריאות ושמחת חיים.", "שתהיה שנה של הפתעות טובות.", "את המתנה הכי גדולה שלנו.", "מזל טוב! תעשי חיים במסיבה.", "שתגדלי להיות אישה חשובה ומשפיעה.", "יום הולדת שמח! אוהבים אותך עד השמיים.", "מאחלים לך רק טוב ומתוק.", "שתהיה לך שנה נהדרת.", "מזל טוב נסיכה קסומה.", "שתמיד תהיי מוקפת באהבה.", "יום הולדת שמח! תהני מכל רגע.", "מאחלים לך שתמיד תפרחי.", "שתהיה שנה של הצלחות."],
            "closings": ["אוהבים אותך.", "אמא ואבא.", "מזל טוב נסיכה.", "חיבוק ענק.", "שלך תמיד.", "באהבה.", "עד 120!", "נשיקות.", "יום הולדת שמח!"]
        }
    };
    // ----------------------------------------

    const wifeSuffixes = [
        "המושלמת", "היפה שלי", "אהבת חיי", "מלכתי", "האחת והיחידה", 
        "החצי השני שלי", "הנסיכה שלי", "אוצר שלי", "המהממת", 
        "אשת חיל שלי", "האור של הבית", "הלב שלי", "כל עולמי", "היקרה מכל"
    ];

    const husbandSuffixes = [
        "המושלם", "הגבר שלי", "אהבת חיי", "מלך העולם", "האחד והיחיד",
        "החצי השני שלי", "הנסיך שלי", "אלוף שלי", "הסלע שלי",
        "האוצר שלי", "היקר באדם", "הלב שלי", "עטרת ראשי", "האבא הכי טוב בעולם"
    ];

    const jsonFiles = [
        "https://raw.githubusercontent.com/Yossi65/berkot/dac4ecf4323f439cba0ddc369665e510983332b1/(%D7%91%D7%95%D7%A7%D7%A8%2C%20%D7%A6%D7%94%D7%A8%D7%99%D7%99%D7%9D%2C%20%D7%A2%D7%A8%D7%91).json",
        "https://raw.githubusercontent.com/Yossi65/berkot/dac4ecf4323f439cba0ddc369665e510983332b1/%D7%90%D7%99%D7%A8%D7%95%D7%A2.json",
        "https://raw.githubusercontent.com/Yossi65/berkot/dac4ecf4323f439cba0ddc369665e510983332b1/%D7%94%D7%A6%D7%9C%D7%97%D7%94%20.json",
        "https://raw.githubusercontent.com/Yossi65/berkot/dac4ecf4323f439cba0ddc369665e510983332b1/%D7%97%D7%91%D7%93.json",
        "https://raw.githubusercontent.com/Yossi65/berkot/dac4ecf4323f439cba0ddc369665e510983332b1/%D7%97%D7%92.json",
        "https://raw.githubusercontent.com/Yossi65/berkot/dac4ecf4323f439cba0ddc369665e510983332b1/%D7%99%D7%95%D7%9D%20%D7%94%D7%95%D7%9C%D7%93%D7%AA%20.json",
        "https://raw.githubusercontent.com/Yossi65/berkot/dac4ecf4323f439cba0ddc369665e510983332b1/%D7%9C%D7%90%D7%94%D7%91%D7%94.json",
        "https://raw.githubusercontent.com/Yossi65/berkot/dac4ecf4323f439cba0ddc369665e510983332b1/%D7%9C%D7%99%D7%93%D7%94.json",
        "https://raw.githubusercontent.com/Yossi65/berkot/dac4ecf4323f439cba0ddc369665e510983332b1/%D7%A8%D7%A4%D7%95%D7%90%D7%94.json",
        "https://raw.githubusercontent.com/Yossi65/berkot/dac4ecf4323f439cba0ddc369665e510983332b1/%D7%A9%D7%91%D7%AA%20%D7%95%D7%9E%D7%95%D7%A6%D7%90%D7%99%20%D7%A9%D7%91%D7%AA.json",
        "https://raw.githubusercontent.com/Yossi65/berkot/dac4ecf4323f439cba0ddc369665e510983332b1/%D7%AA%D7%95%D7%93%D7%94.json"
    ];

    window.onload = function() {
        const savedSender = localStorage.getItem('senderGender') || 'male';
        setSenderGender(savedSender); 

        const savedEmojiState = localStorage.getItem('useEmojis');
        if (savedEmojiState !== null) {
            state.useEmojis = (savedEmojiState === 'true');
        }
        updateEmojiUI(); 

        const savedLength = localStorage.getItem('blessingLength');
        if (savedLength) {
            state.length = savedLength;
            const radio = document.querySelector(`input[name="length"][value="${savedLength}"]`);
            if(radio) radio.checked = true;
        }
        
        loadAllBlessings();
        loadNameHistory(); 
    };

    function loadNameHistory() {
        let history = JSON.parse(localStorage.getItem('nameHistory') || '[]');
        const datalist = document.getElementById('nameHistory');
        datalist.innerHTML = '';
        history.forEach(n => {
            const option = document.createElement('option');
            option.value = n;
            datalist.appendChild(option);
        });
    }

    function saveNameHistory(name) {
        if(!name) return;
        let history = JSON.parse(localStorage.getItem('nameHistory') || '[]');
        if(!history.includes(name)) {
            history.push(name);
            localStorage.setItem('nameHistory', JSON.stringify(history));
            loadNameHistory(); 
        }
    }

    async function loadAllBlessings() {
        const loadingStatus = document.getElementById('loadingStatus');
        
        try {
            const promises = jsonFiles.map(url => fetch(url).then(res => {
                if(!res.ok) throw new Error(`נכשל בטעינת: ${url}`);
                return res.json();
            }));

            const results = await Promise.all(promises);

            results.forEach(data => {
                generators = { ...generators, ...data };
            });

            document.getElementById('loadingOverlay').style.display = 'none';
            document.getElementById('genBtn').disabled = false;
            document.getElementById('genBtn').style.display = 'none'; 

        } catch (error) {
            console.error(error);
            loadingStatus.innerText = "⚠️ שגיאה בטעינת הנתונים. ייתכן שחלק מהברכות חסרות.";
            loadingStatus.style.color = "orange";
        }
    }

    function updateSenderUI() {
        document.getElementById('senderMale').classList.remove('active');
        document.getElementById('senderFemale').classList.remove('active');
        
        if (state.senderGender === 'male') {
            document.getElementById('senderMale').classList.add('active');
            document.documentElement.style.setProperty('--primary', '#4a90e2');
            document.documentElement.style.setProperty('--primary-dark', '#357abd');
            document.documentElement.style.setProperty('--bg', '#b3e5fc'); 
            document.documentElement.style.setProperty('--card', '#f0f8ff'); 
            document.documentElement.style.setProperty('--controls-bg', '#e1f5fe');
        } else {
            document.getElementById('senderFemale').classList.add('active');
            document.documentElement.style.setProperty('--primary', '#e91e63'); 
            document.documentElement.style.setProperty('--primary-dark', '#c2185b'); 
            document.documentElement.style.setProperty('--bg', '#f8bbd0'); 
            document.documentElement.style.setProperty('--card', '#fff0f5'); 
            document.documentElement.style.setProperty('--controls-bg', '#fce4ec');
        }
    }

    function setSenderGender(g) {
        state.senderGender = g;
        localStorage.setItem('senderGender', g);
        updateSenderUI();
    }

    function setLength(len) {
        state.length = len;
        localStorage.setItem('blessingLength', len);
    }

    const emojis = {
        shabbat: ["🕯️", "🍷", "✨", "🥖", "🕍", "🍇", "🤍", "🕊️", "🏡", "💐"],
        motzash: ["🎸", "🕯️", "🍷", "✨", "🌚", "🎶", "💫", "🍯", "🧿", "🌟"],
        morning: ["☀️", "☕", "🌼", "🥐", "🧡", "✨", "יום נפלא"],
        noon: ["🌤️", "🥗", "🥤", "😎", "💪", "המשך יום נעים"],
        night: ["🌙", "⭐", "💤", "🛏️", "✨", "חלומות פז"],
        
        wedding: ["💍", "💒", "🥂", "🤵", "👰"],
        bar_mitzvah: ["📖", "🍬", "🕍", "✡️", "💙"],
        bat_mitzvah: ["📖", "🌸", "🕍", "✡️", "💖"],
        brit_milah: ["👶", "🍼", "💙", "✡️"],
        brita: ["👶", "🍼", "💖", "🌸"],
        birth_boy: ["👶", "💙", "🍼", "🚙", "🧸"],
        birth_girl: ["👶", "💖", "🎀", "🌸", "🦄"],
        housewarming: ["🏠", "🔑", "🪴", "🧿"],
        henna: ["🤚", "🍬", "🕌", "👘"],
        birthday: ["🎂", "🥳", "🎁", "🎈", "🍰"],
        general: ["✨", "🌸", "💫", "🌟", "🙌", "💎", "💐", "🦋", "🌈", "☀️"],
        recovery: ["💊", "🩺", "💪", "❤️"],
        love: ["❤️", "😍", "💋", "💘", "🌹"],
        success: ["🏆", "💼", "🚀", "📈", "⭐", "💰"],
        thank_you: ["🙏", "💐", "💖", "🌺"],
        rosh_hashanah: ["🍎", "🍯", "🍏"],
        hanukkah: ["🕎", "🍩", "🕯️"],
        passover: ["🍷", "🥬"],
        purim: ["🎭", "🍷"],
        tu_bishvat: ["🌳", "🌱", "🍇", "🍊", "🌧️"],
        simchat_torah: ["📜", "💃", "🕍", "🙌"],
        yom_haatzmaut: ["🇮🇱", "🎆", "💙", "🍖"],
        lag_baomer: ["🔥", "🥔", "🕯️", "🏹"],
        tu_beav: ["❤️", "💑", "💍", "💌"],
        rosh_chodesh: ["🌑", "📅", "✨", "🙏"],
        mimouna: ["🥞", "🍯", "🍪", "🪕"],
        chabad: ["👑", "🕯️", "🕍", "📜", "📖"]
    };

    function updateEmojiUI() {
        const btn = document.getElementById('emojiBtn');
        const icon = document.getElementById('emojiIcon');
        if (state.useEmojis) {
            btn.classList.add('active');
            icon.innerText = "✅";
        } else {
            btn.classList.remove('active');
            icon.innerText = "⚪";
        }
    }

    function toggleEmoji() {
        state.useEmojis = !state.useEmojis;
        localStorage.setItem('useEmojis', state.useEmojis);
        updateEmojiUI();
    }

    function goBack() {
        let currentEmojiState = state.useEmojis;
        let currentSender = state.senderGender;
        let currentLength = state.length;
        state = { category: null, subCategory: null, shabbatTime: null, holidayName: null, holidayTarget: null, chabadDate: null, chabadTarget: null, timeOfDay: null, length: currentLength, gender: null, relationKey: null, useEmojis: currentEmojiState, senderGender: currentSender };
        
        document.getElementById('nameInput').value = "";
        document.getElementById('ageInput').value = "";
        document.getElementById('output').innerHTML = '<div style="opacity:0.5; text-align:center; padding-top:10px;">הברכה תופיע כאן...</div>';
        document.getElementById('mainGrid').style.display = 'grid';
        
        document.getElementById('genBtn').style.display = 'none';
        
        document.querySelectorAll('.dynamic-section').forEach(el => el.style.display = 'none');
        document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
        
        document.getElementById('holidayTargetSelector').style.display = 'none';
        document.getElementById('timeTargetSelector').style.display = 'none';
        
        updateSenderUI();
    }

    function selectCategory(cat, btn) {
        state.category = cat;
        document.getElementById('mainGrid').style.display = 'none';
        document.getElementById('inputSection').style.display = 'block';
        
        if (cat === 'morning_evening') {
            document.getElementById('morningEveningSection').style.display = 'block';
            document.getElementById('timeTargetSelector').style.display = 'none';
        }
        else if (cat === 'shabbat') {
            document.getElementById('shabbatSection').style.display = 'block';
            document.getElementById('shabbatTimeSelector').style.display = 'block';
            document.getElementById('shabbatTargetSelector').style.display = 'none';
        }
        else if (cat === 'holiday') {
            document.getElementById('holidaySection').style.display = 'block';
            document.getElementById('holidayNameSelector').style.display = 'block';
            document.getElementById('holidayTargetSelector').style.display = 'none';
        }
        else if (cat === 'chabad') {
            document.getElementById('chabadSection').style.display = 'block';
        }
        else if (cat === 'event') document.getElementById('eventSection').style.display = 'block';
        else if (cat === 'birth') document.getElementById('birthSection').style.display = 'block';
        else if (cat === 'birthday') document.getElementById('birthdaySection').style.display = 'block';
        else {
            if(['success', 'recovery', 'thank_you', 'love'].includes(cat)) {
                document.getElementById('genderSection').style.display = 'block';
            } else {
                document.getElementById('genBtn').style.display = 'block';
            }
        }
    }

    function selectTimeOfDay(time, btn) {
        state.timeOfDay = time;
        const btns = document.querySelectorAll('#timeOfDaySelector .sub-btn');
        btns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('timeTargetSelector').style.display = 'block';
        document.getElementById('genBtn').style.display = 'none'; 
    }

    function selectTimeTarget(target, btn) {
        state.subCategory = target;
        const btns = document.querySelectorAll('#timeTargetSelector .sub-btn');
        btns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('genBtn').style.display = 'block';
    }

    function selectShabbatTime(time) {
        state.shabbatTime = time;
        const btns = document.querySelectorAll('#shabbatTimeSelector .sub-btn');
        btns.forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('shabbatTargetSelector').style.display = 'block';
        document.getElementById('genBtn').style.display = 'block';
    }

    function selectSub(type, btn) {
        if (type.startsWith('chabad_')) {
            state.chabadDate = type;
            let parent = btn.parentElement;
            parent.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if (state.chabadTarget) document.getElementById('genBtn').style.display = 'block';
            return;
        }
        
        if (state.category === 'chabad' && !type.startsWith('chabad_')) {
            state.chabadTarget = type;
            let parent = btn.parentElement;
            parent.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if (state.chabadDate) document.getElementById('genBtn').style.display = 'block';
            return;
        }

        state.subCategory = type;
        let parent = btn.parentElement;
        parent.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('genBtn').style.display = 'block';
    }

    function selectHolidayName(hName, btn) {
        state.holidayName = hName;
        const btns = document.querySelectorAll('#holidayNameSelector .sub-btn');
        btns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('holidayTargetSelector').style.display = 'block';
        document.getElementById('genBtn').style.display = 'block';
    }

    function selectHolidayTarget(target, btn) {
        state.holidayTarget = target;
        const btns = document.querySelectorAll('#holidayTargetSelector .sub-btn');
        btns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function selectGenderGeneral(g, btn) {
        state.gender = g;
        let parent = btn.parentElement;
        parent.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('genBtn').style.display = 'block';
    }

    function selectGender(gender, btn) {
        state.gender = gender;
        let parent = btn.parentElement;
        parent.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // --- סדר הכפתורים כפי שביקשת ---
        const relationsMap = {
            man: [
                { label: "חבר 🍻", key: "friend_male" },
                { label: "אח 👊", key: "brother" },
                { label: "אבא 👑", key: "dad" },
                { label: "בעלי 💍", key: "husband" },
                { label: "בן זוגי 💑", key: "partner_male" }
            ],
            woman: [
                { label: "חברה 👯‍♀️", key: "friend_female" },
                { label: "אחות 🌸", key: "sister" },
                { label: "אמא 👑", key: "mom" },
                { label: "אשתי 💍", key: "wife" },
                { label: "בת זוגתי 💑", key: "partner_female" }
            ],
            boy: [
                { label: "ילד ⚽", key: "boy" }, // כללי
                { label: "בן 💙", key: "son" }, // הבן שלי
                { label: "נכד 🧸", key: "boy" }, 
                { label: "חבר 🚲", key: "boy" }
            ],
            girl: [
                { label: "ילדה 🎀", key: "girl" }, // כללי
                { label: "בת 💖", key: "daughter" }, // הבת שלי
                { label: "נכדה 🦄", key: "girl" },
                { label: "חברה 👭", key: "girl" }
            ]
        };
        
        const grid = document.getElementById('relationsGrid');
        grid.innerHTML = '';
        (relationsMap[gender] || []).forEach(relItem => {
            const b = document.createElement('button');
            b.className = 'sub-btn';
            b.innerText = relItem.label;
            b.onclick = (e) => {
                // שומרים את המפתח האנגלי (למשל 'mom', 'wife') בסטייט!
                state.relationKey = relItem.key;
                
                grid.querySelectorAll('.sub-btn').forEach(x => x.classList.remove('active'));
                e.target.classList.add('active');
            };
            grid.appendChild(b);
        });
        document.getElementById('relationsContainer').style.display = 'block';
        document.getElementById('genBtn').style.display = 'block';
    }

    function getDistinctRandom(arr, count) {
        if (!arr || arr.length === 0) return [];
        const shuffled = [...arr].sort(() => 0.5 - Math.random());
        return shuffled.slice(0, count);
    }

    function adjustTextForSender(text) {
        if (state.senderGender === 'female') {
            const replacements = [
                { m: "מאחל", f: "מאחלת" },
                { m: "אוהב", f: "אוהבת" },
                { m: "מעריך", f: "מעריכה" },
                { m: "שולח", f: "שולחת" },
                { m: "בטוח", f: "בטוחה" },
                { m: "חושב", f: "חושבת" },
                { m: "מתגעגע", f: "מתגעגעת" },
                { m: "מוקיר", f: "מוקירה" },
                { m: "מאמין", f: "מאמינה" },
                { m: "סומך", f: "סומכת" },
                { m: "מחזיק", f: "מחזיקה" },
                { m: "מודה", f: "מודה" }
            ];

            let newText = text;
            replacements.forEach(pair => {
                newText = newText.split(pair.m).join(pair.f);
            });
            return newText;
        }
        return text;
    }

    function generateBlessing() {
        document.getElementsByName('length').forEach(l => { if(l.checked) state.length = l.value });
        const output = document.getElementById('output');
        let key = "";

        if (state.category === 'morning_evening') {
             if (!state.timeOfDay || !state.subCategory) { alert("נא לבחור זמן ויעד..."); return; }
             key = `${state.timeOfDay}_${state.subCategory}`;
        }
        else if (state.category === 'shabbat') {
            if (!state.shabbatTime || !state.subCategory) { alert("נא לבחור זמן ויעד..."); return; }
            key = `${state.shabbatTime}_${state.subCategory}`;
        }
        else if (state.category === 'holiday') {
             if (!state.holidayName || !state.holidayTarget) { alert("נא לבחור חג ויעד..."); return; }
             key = `${state.holidayName}_${state.holidayTarget}`;
        }
        else if (state.category === 'chabad') {
             if (!state.chabadDate || !state.chabadTarget) { alert("נא לבחור תאריך ויעד..."); return; }
             key = `${state.chabadDate}_${state.chabadTarget}`;
        }
        else if (state.category === 'event') {
             if (!state.subCategory) { alert("נא לבחור..."); return; }
             key = state.subCategory;
        }
        else if (state.category === 'birth') {
             if (!state.subCategory) { alert("נא לבחור..."); return; }
             key = state.subCategory;
        }
        else if (state.category === 'birthday') {
             // לוגיקת יום הולדת
             if (state.relationKey) {
                 key = `birthday_${state.relationKey}`;
             } else {
                 const bdKey = (state.gender === 'woman' || state.gender === 'girl' || state.gender === 'female') ? 'birthday_female' : 'birthday_male';
                 key = bdKey;
             }
        } 
        else if (['success', 'recovery', 'thank_you', 'love'].includes(state.category)) {
             if (!state.gender) { alert("נא לבחור מין..."); return; }
             key = `${state.category}_${state.gender}`;
        }
        else {
            key = state.category;
        }

        // --- התיקון הקריטי: חיפוש קודם במאגר הראשי, ואם אין - בגיבוי המקומי ---
        let gen = generators[key];
        
        // אם הברכה חסרה במאגר החיצוני (למשל בת זוג), נחפש בגיבוי הפנימי
        if (!gen && localBlessings[key]) {
            gen = localBlessings[key];
        }

        // נסיונות גיבוי למקרה שלא נמצא שום דבר
        if (!gen) {
            if (state.category === 'shabbat') gen = generators[`${state.shabbatTime}_general`];
            else if (state.category === 'holiday') gen = generators[`${state.holidayName}_general`] || generators[`${state.holidayName}`];
            else if (state.category === 'chabad') gen = generators[state.chabadDate];
            else if (state.category === 'birthday') {
                 // ברירת מחדל אחרונה
                 const fallbackKey = (state.gender === 'woman' || state.gender === 'girl') ? 'birthday_female' : 'birthday_male';
                 gen = generators[fallbackKey];
            }
        }
        
        if (!gen) { 
            output.innerHTML = `<div style="color:red; text-align:center">לא נמצאו ברכות לקטגוריה: ${key}</div>`; 
            return; 
        }

        let parts = [];
        const name = document.getElementById('nameInput').value.trim();
        saveNameHistory(name); 

        if (name) {
            let suffix = "היקר/ה";
            
            const isWifeContext = (state.relationKey === 'wife' || state.relationKey === 'partner_female' || state.holidayTarget === 'wife');
            const isHusbandContext = (state.relationKey === 'husband' || state.relationKey === 'partner_male' || state.holidayTarget === 'husband');

            const isGenericFemale = (state.gender === 'woman' || state.gender === 'girl' || state.gender === 'female');
            const isGenericMale = (state.gender === 'man' || state.gender === 'boy' || state.gender === 'male');

            if (isWifeContext) {
                suffix = wifeSuffixes[Math.floor(Math.random() * wifeSuffixes.length)];
            } else if (isHusbandContext) {
                suffix = husbandSuffixes[Math.floor(Math.random() * husbandSuffixes.length)];
            } else {
                if (isGenericFemale) suffix = "היקרה";
                else if (isGenericMale) suffix = "היקר";
            }
            
            parts.push(`${name} ${suffix},`);
        }

        parts.push(getDistinctRandom(gen.openers, 1)[0]);
        const bodyCount = state.length === 'long' ? 2 : 1;
        const bodies = getDistinctRandom(gen.bodies, bodyCount);
        parts.push(...bodies);

        if (state.category !== 'morning_evening') {
            parts.push(getDistinctRandom(gen.closings, 1)[0]);
        }

        let adjustedParts = parts.map(part => adjustTextForSender(part));

        let emojiSet = 'general';
        if (state.category === 'morning_evening') emojiSet = state.timeOfDay;
        else if (state.category === 'shabbat') emojiSet = state.shabbatTime;
        else if (state.category === 'holiday') emojiSet = state.holidayName;
        else if (state.category === 'birth') emojiSet = state.subCategory;
        else if (state.category === 'chabad') emojiSet = state.chabadDate;
        else if (emojis[key]) emojiSet = key;
        else if (emojis[state.category]) emojiSet = state.category;

        if (state.category === 'chabad' && !emojis[emojiSet]) emojiSet = 'chabad';

        renderLinesWithEmojis(adjustedParts, emojiSet);
    }

    function renderLinesWithEmojis(linesArray, setKey) {
        const cleanLines = linesArray.filter(l => l && l.trim() !== "");
        let availableEmojis = [...(emojis[setKey] || emojis['general'])]; 
        
        const container = document.getElementById('output');
        container.innerHTML = ''; 

        cleanLines.forEach(line => {
            let lineContent = line.trim();
            if (state.useEmojis) {
                if (availableEmojis.length === 0) availableEmojis = [...(emojis[setKey] || emojis['general'])];
                const randomIndex = Math.floor(Math.random() * availableEmojis.length);
                const emoji = availableEmojis[randomIndex];
                availableEmojis.splice(randomIndex, 1); 
                lineContent = `${lineContent} ${emoji}`;
            }
            
            const row = document.createElement('div');
            row.className = 'line-item';
            row.innerHTML = `
                <button class="delete-line-btn" onclick="this.parentElement.remove()" title="מחק שורה זו">✕</button>
                <div class="line-text" contenteditable="true">*${lineContent}*</div>
            `;
            container.appendChild(row);
        });
    }

    function getVisibleText() {
        const rows = document.querySelectorAll('.line-text');
        return Array.from(rows).map(r => r.innerText.trim()).join('\n');
    }

    function copyText() {
        const textToCopy = getVisibleText();
        if(!textToCopy) return;
        
        navigator.clipboard.writeText(textToCopy);
        const btn = document.querySelector('.btn-copy');
        let old = btn.innerText; btn.innerText = "הועתק! 👍"; setTimeout(() => btn.innerText = old, 1500);
    }

    function sendWhatsapp() {
        let text = getVisibleText();
        if(!text) return alert("קודם צור ברכה!");
        window.open(`whatsapp://send?text=${encodeURIComponent(text)}`, '_blank');
    }
</script>

</body>
</html>
